# 地图服务瓦片加解密和GLTF加解密工具集

## 项目概述

本项目提供了一套完整的地图服务瓦片加解密和GLTF文件加解密解决方案，主要用于保护地理信息数据和3D模型文件的安全性。通过多种加密策略和文件处理方式，确保数据在传输和存储过程中的安全性。

针对项目上对数据安全性的考虑，需要对数据进行加密，不同的go是个人对不同加密效果的测试，可能不同方式适应不同场景，比如文件加密适用离线使用，行列号混淆适用保密性要求不高的场景。

这个工程是个人学习的一个过程，学习过程中写的代码也保留下来，方便后面复习。

### 核心思路

#### 地图服务瓦片加解密
1. **文件级加密**：对瓦片图片文件进行AES加密，保护原始数据
2. **路径混淆**：通过层行列坐标变换算法，打乱瓦片的存储路径结构
3. **动态解密**：服务端根据请求参数实时解密并返回瓦片数据
4. **多重保护**：结合文件加密和路径混淆，提供双重安全保障

#### GLTF加解密
1. **大文件分块处理**：支持大文件的分块加密，每块100MB进行处理
2. **AES-CBC加密**：使用AES-CBC模式进行数据加密
3. **Base64编码**：加密后进行Base64编码，便于传输和存储
4. **流式处理**：支持流式读写，提高大文件处理效率

## 文件详细说明

### 1. 瓦片加密工具

#### `tileEncrypt.go` - 瓦片加密工具（Base64版本）
- **功能**：将瓦片图片转换为Base64格式后进行AES加密
- **特点**：
  - 支持JPEG/PNG格式检测
  - 生成可直接在浏览器中显示的Data URL
  - 加密后文件扩展名为`.by`
  - 保持原始目录结构
- **使用场景**：需要在前端直接显示加密瓦片的场景

#### `tileEncrypt2.go` - 瓦片加密工具（二进制版本）
- **功能**：直接对瓦片图片二进制数据进行AES加密
- **特点**：
  - 不进行Base64转换，直接加密原始数据
  - 文件大小相对较小
  - 加密后文件扩展名为`.by`
  - 保持原始目录结构
- **使用场景**：对文件大小有要求的场景

#### `tileEncrypt3.go` - 瓦片加密工具（路径混淆版本）
- **功能**：结合AES加密和路径混淆的瓦片加密工具
- **特点**：
  - 使用层行列坐标变换算法
  - 通过SHA256和MD5双重哈希生成文件名
  - 打乱原始文件存储路径
  - 提供更强的安全性
- **算法**：`rad = lv ^ col`, `r_row = row ^ rad`, `r_col = col ^ rad`

### 2. 瓦片打乱工具

#### `ShuffleTile1.go` - 瓦片路径打乱工具（移动文件）
- **功能**：通过层行列变换算法重新组织瓦片文件结构
- **特点**：
  - 使用文件移动操作
  - 保持层级目录结构
  - 文件名保持原始格式
- **算法**：`rad = (lv * lv * row) ^ col`, `_lv = lv ^ rad`, `_row = row ^ rad`, `_col = col ^ rad`

#### `ShuffleTile2.go` - 瓦片路径打乱工具（扁平化）
- **功能**：将瓦片文件打乱后存储为扁平化结构
- **特点**：
  - 将所有文件存储在同一目录下
  - 文件名格式：`层行列.png`
  - 减少目录层级复杂度

#### `ShuffleTile3.go` - 瓦片路径打乱工具（复制文件）
- **功能**：通过复制操作重新组织瓦片文件
- **特点**：
  - 使用文件复制而非移动
  - 保持原始文件不变
  - 保持层级目录结构

#### `ShuffleTile4.go` - 瓦片路径打乱工具（扁平化复制）
- **功能**：结合复制操作和扁平化存储
- **特点**：
  - 复制文件到扁平化结构
  - 保持原始文件扩展名
  - 文件名格式：`层行列.扩展名`

### 3. 瓦片服务端

#### `server.go` - 基础瓦片服务端
- **功能**：提供瓦片数据的HTTP服务
- **特点**：
  - 支持GET/POST请求处理
  - 通过URL参数传递解密密钥
  - 支持Base64解密
  - 监听端口：8000

#### `瓦片加密/server.go` - 高级瓦片服务端
- **功能**：支持路径混淆的瓦片服务端
- **特点**：
  - 集成路径混淆算法
  - 支持SHA256和MD5哈希
  - 自动解析层行列参数
  - 监听端口：8041
  - 支持二进制数据解密

### 4. GLTF加解密工具

#### `gltfencrypt/encryptGltf.go` - GLTF加密工具（完整版）
- **功能**：完整的GLTF文件加解密工具
- **特点**：
  - 支持大文件分块处理（100MB/块）
  - 集成加密和解密功能
  - 详细的处理进度显示
  - 支持自定义输入输出路径

#### `gltfencrypt/encryptGltf2.go` - GLTF加密工具（简化版）
- **功能**：简化版GLTF文件加解密工具
- **特点**：
  - 移除部分详细输出
  - 保持核心加解密功能
  - 更简洁的代码结构

#### `gltfencrypt/encryptHelpers/encryptHelpers.go` - 加密辅助工具
- **功能**：提供加密相关的辅助函数
- **特点**：
  - 封装AES加密解密逻辑
  - 提供PKCS7填充功能
  - 支持Base64编码解码
  - 可作为库函数使用

## 技术特点

### 加密算法
- **AES-CBC模式**：使用16字节密钥进行加密
- **PKCS7填充**：确保数据块对齐
- **Base64编码**：便于传输和存储

### 安全特性
- **路径混淆**：通过数学变换打乱文件存储位置
- **双重哈希**：SHA256 + MD5组合使用
- **动态解密**：服务端实时解密，不存储明文

### 性能优化
- **分块处理**：支持大文件的分块加密
- **流式读写**：减少内存占用
- **并发处理**：支持多文件并行处理

## 使用说明

### 瓦片加密
1. 运行对应的加密工具（如`tileEncrypt.go`）
2. 输入源数据目录和目标目录
3. 设置加密密钥
4. 工具自动处理所有瓦片文件

### 瓦片服务
1. 启动对应的服务端程序
2. 通过HTTP请求访问瓦片：`/tile/{z}/{x}/{y}.png?key={解密密钥}`
3. 服务端自动解密并返回瓦片数据

### GLTF加密
1. 运行GLTF加密工具
2. 输入源文件路径和输出路径
3. 工具自动进行分块加密处理

## 注意事项

1. **密钥管理**：请妥善保管加密密钥，避免泄露
2. **文件备份**：加密前请备份原始文件
3. **性能考虑**：大文件加密可能需要较长时间
4. **兼容性**：确保客户端支持对应的解密算法

## 开发环境

- **语言**：Go
- **加密库**：crypto/aes, crypto/cipher
- **网络库**：net/http
- **文件操作**：os, io/ioutil

## 

本项目仅供学习和研究使用，请遵守相关法律法规。 